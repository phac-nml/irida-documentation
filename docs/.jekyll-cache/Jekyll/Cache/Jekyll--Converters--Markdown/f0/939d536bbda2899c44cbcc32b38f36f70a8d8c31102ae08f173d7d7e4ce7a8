I"°<h1 id="mentalist-mlst-analysis">MentaLiST MLST Analysis</h1>

<p>This workflow uses the software <a href="https://github.com/WGS-TB/MentaLiST">MentaLiST</a> for typing of microbial samples directly from sequence reads.  The specific Galaxy tools are listed in the table below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Tool Name</th>
      <th style="text-align: center">Owner</th>
      <th style="text-align: center">Tool Revision</th>
      <th style="text-align: center">Toolshed Installable Revision</th>
      <th style="text-align: center">Toolshed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>mentalist</strong></td>
      <td style="text-align: center">dfornika</td>
      <td style="text-align: center">a6cd59f35832</td>
      <td style="text-align: center">9 (2018-06-26)</td>
      <td style="text-align: center"><a href="http://toolshed.g2.bx.psu.edu/">Galaxy Main Shed</a></td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>combine_tabular_collection</strong></td>
      <td style="text-align: center">nml</td>
      <td style="text-align: center">b815081988b5</td>
      <td style="text-align: center">0 (2017-02-06)</td>
      <td style="text-align: center"><a href="http://toolshed.g2.bx.psu.edu/">Galaxy Main Shed</a></td>
    </tr>
  </tbody>
</table>

<h2 id="step-1-galaxy-conda-setup">Step 1: Galaxy Conda Setup</h2>

<p>Galaxy makes use of <a href="https://conda.io/docs/">Conda</a> to automatically install some dependencies for MentaLiST.  Please verify that the version of Galaxy is &gt;= v16.01 and has been setup to use conda (by modifying the appropriate configuration settings, see <a href="../../setup#step-4-modify-configuration-file">here</a> for additional details).</p>

<h2 id="step-2-install-galaxy-tools">Step 2: Install Galaxy Tools</h2>

<p>Please install all the <code>mentalist</code> Galaxy tool by logging into Galaxy, navigating to <strong>Admin &gt; Search Tool Shed</strong>, searching for <code>mentalist</code> and installing the appropriate <strong>Toolshed Installable Revision</strong>.</p>

<p>The install progress can be checked by monitoring the Galaxy log files <code>galaxy/*.log</code>.  On completion you should see a message of <code>Installed</code> next to the tool when going to <strong>Admin &gt; Manage installed tool shed repositories</strong>.</p>

<h2 id="step-3-installing-mentalist-kmer-databases">Step 3: Installing MentaLiST kmer Databases</h2>

<p>MentaLiST requires an organism-specific kmer database to search against. Log in to Galaxy and navigate to <strong>Admin &gt; Local data</strong>. Under <strong>Run Data Manager Tools</strong>, select <strong>MentaLiST Download from pubMLST</strong></p>

<p><img src="../test/mentalist/images/mentalist-data-managers.png" alt="mentalist-data-managers" /></p>

<p>Choose your kmer size. The default kmer size of 31 should work well for most applications. From the drop-down menu, select â€˜Salmonella entericaâ€™.</p>

<p><img src="../test/mentalist/images/mentalist-download-pubmlst.png" alt="mentalist-download-pubmlst" /></p>

<p>A green result box will appear in the galaxy history once the database is complete:</p>

<p><img src="../test/mentalist/images/mentalist-download-pubmlst-result.png" alt="mentalist-download-pubmlst-result" /></p>

<p>To confirm that the database is installed, select <strong>mentalist_databases</strong> from the list of available Tool Data Tables:</p>

<p><img src="../test/mentalist/images/mentalist-data-table-list.png" alt="mentalist-data-table-list" /></p>

<p>Your new MentaLiST database will be listed in the table of available MentaLiST databases. If it doesnâ€™t appear, click the refresh button at the top of the table.</p>

<p><img src="../test/mentalist/images/mentalist-database-available.png" alt="mentalist-database-available" /></p>

<h2 id="step-4-testing-pipeline">Step 4: Testing Pipeline</h2>

<p>A Galaxy workflow and some test data has been included with this documentation to verify that all tools are installed correctly.  To test this pipeline, please proceed through the following steps.</p>

<ol>
  <li>Upload the <a href="../test/mentalist/mentalist.ga">MentaLiST Galaxy Workflow</a> by going to <strong>Workflow &gt; Upload or import workflow</strong>.</li>
  <li>
    <p>Upload the sequence reads by going to <strong>Analyze Data</strong> and then clicking on the <strong>upload files from disk</strong> icon <img src="../test/mentalist/images/upload-icon.png" alt="upload-icon" />.  Select the <a href="../test/sistr/reads">test/reads</a> files.  Make sure to change the <strong>Type</strong> of each file from <strong>Auto-detect</strong> to <strong>fastqsanger</strong>.  When uploaded you should see the following in your history.</p>

    <p><img src="../test/mentalist/images/upload-history.png" alt="upload-history" /></p>
  </li>
  <li>
    <p>Construct a dataset collection of the paired-end reads by clicking the <strong>Operations on multiple datasets</strong> icon <img src="../test/mentalist/images/datasets-icon.png" alt="datasets-icon" />.  Please check off the two <strong>.fastq</strong> files and then go to <strong>For all selectedâ€¦ &gt; Build List of dataset pairs</strong>.  You should see a screen that looks as follows.</p>

    <p><img src="../test/mentalist/images/dataset-pair-screen.png" alt="dataset-pair-screen" /></p>
  </li>
  <li>This should have properly paired your data and named the sample <strong>AE014613-699860</strong>.  Enter the name of this paired dataset collection at the bottom and click <strong>Create list</strong>.</li>
  <li>Run the uploaded workflow by clicking on <strong>Workflow</strong>, clicking on the name of the workflow <strong>MentaLiST MLST v0.1 (imported from uploaded file)</strong> and clicking <strong>Run</strong>.  This should auto fill in the dataset collection.  Ensure that an appropriate kmer database (Salmonella enterica) has been selected before running the workflow. At the very top of the screen click <strong>Run workflow</strong>.</li>
  <li>
    <p>If everything was installed correctly, you should see each of the tools run successfully (turn green).  On completion this should look like.</p>

    <p><img src="../test/mentalist/images/workflow-success.png" alt="workflow-success" /></p>

    <p>If you see any tool turn red, you can click on the view details icon <img src="../test/mentalist/images/view-details-icon.png" alt="view-details-icon" /> for more information.</p>
  </li>
</ol>

<p>If everything was successfull then all dependencies for this pipeline have been properly installed.</p>

<h2 id="note-duplicate-data-managers">Note: Duplicate Data Managers</h2>

<p>If multiple versions of the <code>mentalist</code> tool have been installed, there will be multiple entries for each Data Manager tool. The <strong>Admin &gt; Local Data</strong> page may look like this:</p>

<p><img src="../test/mentalist/images/mentalist-duplicate-data-managers.png" alt="mentalist-duplicate-data-managers" /></p>

<p>If that is the case, you can remove the duplicates by deactivating mentalist <code>0.1.3</code> or any other older versions that may be installed:</p>

<p><img src="../test/mentalist/images/mentalist-deactivate-old-version.png" alt="mentalist-deactivate-old-version" /></p>

:ET